include(${PROJECT_SOURCE_DIR}/test_target.cmake)
create_test_target(
    TARGET
        TestKeyValueDatabase
    TEST_SOURCES
        test_key_value_db.cpp
    INSTRUMENTED_SOURCES
        ${PROJECT_SOURCE_DIR}/../mbedutils/src/database/db_intf.cpp
        ${PROJECT_SOURCE_DIR}/../mbedutils/src/database/db_kv_node.cpp
        ${PROJECT_SOURCE_DIR}/../mbedutils/src/database/db_kv_mgr.cpp
    DEPENDENT_SOURCES
        ${PROJECT_SOURCE_DIR}/../mbedutils/lib/flashdb/port/fal/src/fal.c
        ${PROJECT_SOURCE_DIR}/../mbedutils/lib/flashdb/port/fal/src/fal_flash.c
        ${PROJECT_SOURCE_DIR}/../mbedutils/lib/flashdb/port/fal/src/fal_partition.c
        ${PROJECT_SOURCE_DIR}/../mbedutils/lib/flashdb/src/fdb_kvdb.c
        ${PROJECT_SOURCE_DIR}/../mbedutils/lib/flashdb/src/fdb_tsdb.c
        ${PROJECT_SOURCE_DIR}/../mbedutils/lib/flashdb/src/fdb_utils.c
        ${PROJECT_SOURCE_DIR}/../mbedutils/lib/flashdb/src/fdb.c
        ${PROJECT_SOURCE_DIR}/expect/gpio_intf_expect.cpp
        ${PROJECT_SOURCE_DIR}/expect/mutex_intf_expect.cpp
        ${PROJECT_SOURCE_DIR}/expect/nor_flash_expect.cpp
        ${PROJECT_SOURCE_DIR}/expect/spi_intf_expect.cpp
        ${PROJECT_SOURCE_DIR}/expect/time_intf_expect.cpp
        ${PROJECT_SOURCE_DIR}/mock/gpio_intf_mock.cpp
        ${PROJECT_SOURCE_DIR}/mock/mutex_intf_mock.cpp
        ${PROJECT_SOURCE_DIR}/mock/nor_flash_mock.cpp
        ${PROJECT_SOURCE_DIR}/mock/spi_intf_mock.cpp
        ${PROJECT_SOURCE_DIR}/mock/time_intf_mock.cpp
        ${CMAKE_CURRENT_SOURCE_DIR}/test_kv_db.pb.c
    INCLUDE_DIRS
        ./
        ${TESTING_INCLUDE_DIRECTORIES}
    LIBRARIES
        mbedutils_lib_stl
        mbedutils_headers
        mbedutils_internal_headers
    EXPORT_DIR ${CMAKE_CURRENT_BINARY_DIR}
)
